{
  "name": "Deploy-MDFC-Config-CAF",
  "type": "Microsoft.Authorization/policySetDefinitions",
  "apiVersion": "2021-06-01",
  "scope": null,
  "properties": {
    "policyType": "Custom",
    "displayName": "Deploy Microsoft Defender for Cloud configuration (CAF)",
    "description": "Deploy Microsoft Defender for Cloud configuration (CAF)",
    "metadata": {
      "version": "3.1.1",
      "category": "Security Center",
      "source": "https://github.com/Azure/Enterprise-Scale/",
      "alzCloudEnvironments": [
        "AzureCloud"
      ]
    },
    "parameters": {
      "emailSecurityContact": {
        "type": "string",
        "metadata": {
          "displayName": "Security contacts email address",
          "description": "Provide email address for Microsoft Defender for Cloud contact details"
        }
      },
      "minimalSeverity": {
        "type": "string",
        "allowedValues": [
          "High",
          "Medium",
          "Low"
        ],
        "defaultValue": "High",
        "metadata": {
          "displayName": "Minimal severity",
          "description": "Defines the minimal alert severity which will be sent as email notifications"
        }
      },
      "enableAscForCosmosDbs": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForSql": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForSqlOnVm": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForDns": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForArm": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForOssDb": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForAppServices": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForKeyVault": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForStorage": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForContainers": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      },
      "enableAscForServers": {
        "type": "String",
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      }
    },
    "policyDefinitions": [
      {
        "policyDefinitionReferenceId": "defenderForOssDb",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/44433aa3-7ec2-4002-93ea-65c65ff0310a",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForOssDb')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForVM",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/8e86a5b6-b9bd-49d1-8e21-4bb8a0862222",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForServers')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForSqlServerVirtualMachines",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/50ea7265-7d8c-429e-9a7d-ca1f410191c3",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForSqlOnVm')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForAppServices",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b40e7bcd-a1e5-47fe-b9cf-2f534d0bfb7d",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForAppServices')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForStorageAccounts",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/74c30959-af11-47b3-9ed2-a26e03f427a3",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForStorage')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderforContainers",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/c9ddb292-b203-4738-aead-18e2716e858f",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForContainers')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForKeyVaults",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1f725891-01c0-420a-9059-4fa46cb770b7",
        "parameters": {
          "Effect": {
            "value": "[parameters('enableAscForKeyVault')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForDns",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/2370a3c1-4a25-4283-a91a-c9c1a145fb2f",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForDns')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForArm",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b7021b2b-08fd-4dc0-9de7-3c6ece09faf9",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForArm')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForSqlPaas",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b99b73e7-074b-4089-9395-b7236f094491",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForSql')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "defenderForCosmosDbs",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/82bf5b87-728b-4a74-ba4d-6123845cf542",
        "parameters": {
          "effect": {
            "value": "[parameters('enableAscForCosmosDbs')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "securityEmailContact",
        "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/Deploy-ASC-SecurityContacts-CAF",
        "parameters": {
          "emailSecurityContact": {
            "value": "[parameters('emailSecurityContact')]"
          },
          "minimalSeverity": {
            "value": "[parameters('minimalSeverity')]"
          }
        },
        "groupNames": []
      }
    ],
    "policyDefinitionGroups": null
  }
}